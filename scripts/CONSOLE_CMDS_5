# Console Commands for Step 5
# Do not use echo commands
# Only edit the section of this document between CODE START and CODE END

### CODE START ###
# Validate version file
python -c "from scripts.version import validate_version_file; assert validate_version_file()"

# Validate database connection  
python -c "from scripts.version import validate_db_connection; assert validate_db_connection('instance/app.db')"

# Bump version and create release branch
python -c "import scripts.version as v; new_version = v.bump_version('patch'); branch_name = f'release/v{new_version}'; v.update_version_file(new_version); print(f'Created release branch: {branch_name}')"

# Push changes to GitHub
python -c "import scripts.version as v; v.push_to_github('release/v0.1.1', 'Release v0.1.1 - Patch update')"

# Run database migrations
flask db upgrade

# Run tests
pytest tests/ --cov=app --cov-report=term-missing

# Update documentation
python -c "from scripts.version import get_version; version = get_version(); open('RELEASE_NOTES.md', 'w').write(f'# Release {version}\n\n- Fixed version validation\n- Improved database connection handling')"
### CODE END ###

# Print the current datetime to console
/run scripts/print_datetime.py
/run Write-Host "Code Cycle Complete"

# Final updates
# Update requests

/add scripts/REQUESTS
/add scripts/MANAGER
/code Final cleanup before reset. Remove any requests from MANAGER that have been implemented or scheduled for implementation. Update DEVLOG based on this cycle. Add any requests for actions you need performed to REQUESTS. Update TODO list if needed. Keep DEVLOG and TODO as compact as possible, prune and remove what you can.

# Reset and start Code Cycle over again
/reset
/load scripts\STEP_1
