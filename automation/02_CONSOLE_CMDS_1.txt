# Console Commands for Step 1 (Analyzing)
# Do not use echo
# Only edit the section of this document between CODE START and CODE END

### CODE START ###

# Clean migration state and reapply
/run del instance\\stipend.db
/run alembic upgrade head --sql > full_migration.sql
/run sqlite3 instance/stipend.db < full_migration.sql

# Schema verification
/run python scripts/verification/verify_db_schema.py --check-column user.confirmed_at
/run python -c "import sqlite3; conn=sqlite3.connect('instance/stipend.db'); print(conn.execute('SELECT sql FROM sqlite_master WHERE type=\"table\" AND name=\"user\"').fetchone()[0])"

# Security verification
/run python scripts/verification/verify_security.py --full-audit --check-admin-interface

### CODE END ###

# Console commands done, we go on to 03_STEP_2.txt
/load automation/03_STEP_2.txt
